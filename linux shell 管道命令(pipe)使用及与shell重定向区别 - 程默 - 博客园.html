<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html lang="zh-cn">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>linux shell 管道命令(pipe)使用及与shell重定向区别 - 程默 - 博客园</title>
<link type="text/css" rel="stylesheet" href="/bundles/blog-common.css?v=VDh8zSH1vx51MDqRT7hK220akQ58FjlaaeGuWBPhfOA1"/>
<link id="MainCss" type="text/css" rel="stylesheet" href="/skins/Cogitation/bundle-Cogitation.css?v=KxzCsGje7vptXKdp2HZBpXmgRp_h-PvgHFxMy8F9r3o1"/>
<link type="text/css" rel="stylesheet" href="/blog/customcss/71819.css?v=e2E%2fy%2bxcHUfVqipP3l8dm1gBggQ%3d"/>
<link title="RSS" type="application/rss+xml" rel="alternate" href="http://www.cnblogs.com/chengmo/rss"/>
<link title="RSD" type="application/rsd+xml" rel="EditURI" href="http://www.cnblogs.com/chengmo/rsd.xml"/>
<link type="application/wlwmanifest+xml" rel="wlwmanifest" href="http://www.cnblogs.com/chengmo/wlwmanifest.xml"/>
<script src="http://common.cnblogs.com/script/jquery.js" type="text/javascript"></script>  
<script type="text/javascript">var currentBlogApp = 'chengmo', cb_enable_mathjax=false;</script>
<script src="/bundles/blog-common.js?v=Lo_yNgOy3xSX4jFztznlaU-fp0VmAT5VQ5SPZYVI7BE1" type="text/javascript"></script>
</head>
<body>
<a name="top"></a>

<div id="top">
	
<div>
	<table>
		<tr>
			<td class="HeaderTitles">
				<h1 class="HeaderTitle"><a id="Header1_HeaderTitle" class="HeaderMainTitle" href="http://www.cnblogs.com/chengmo/">沉于思考，默默学习！</a></h1>
				<p id="tagline">你不能预知明天，但你可以利用今天。你不能样样顺利，但你可以事事尽力!</p>
			</td>
		</tr>
	</table>
</div>
<div class="HeaderBar">
	<table id="HeaderBar" class="HeaderBar" cellpadding="0" cellspacing="0">
		<tr>
			<td class="HeaderBarTab" nowrap>
&nbsp;
<a id="Header1_MyLinks1_HomeLink" href="http://www.cnblogs.com/">博客园</a> ::
<a id="Header1_MyLinks1_MyHomeLink" href="http://www.cnblogs.com/chengmo/">首页</a> ::
<a href="http://q.cnblogs.com" class="menu">博问</a> ::
<a href="http://home.cnblogs.com/ing/" class="menu">闪存</a> ::
<a id="Header1_MyLinks1_NewPostLink" rel="nofollow" href="http://i.cnblogs.com/EditPosts.aspx?opt=1">新随笔</a> ::
<a id="Header1_MyLinks1_ContactLink" accesskey="9" rel="nofollow" href="http://msg.cnblogs.com/send/%E7%A8%8B%E9%BB%98">联系</a> ::
<a id="Header1_MyLinks1_Syndication" href="http://www.cnblogs.com/chengmo/rss">订阅</a>
<a id="Header1_MyLinks1_XMLLink" class="XMLLink" href="http://www.cnblogs.com/chengmo/rss"><img src="http://www.cnblogs.com/images/xml.gif" alt="订阅" /></a> ::
<a id="Header1_MyLinks1_Admin" rel="nofollow" href="http://i.cnblogs.com/">管理</a> ::

</td>
			<td><img id="Header1_BlueTab" src="/skins/Cogitation/Images/BlueTabRight.gif" align="absmiddle" /></td>
			<td class="HeaderBarTabBack" nowrap width="100%">
				
<div class="BlogStatsBar">
	<table class="BlogStatsBar">
		<tr>
			<td width="100%">
			</td>
			<td class="BlogStatsBar" nowrap>
				&nbsp;
				63 
				随笔&nbsp;::
				0 文章
				::
				588 评论
				::
				0 引用
			</td>
		</tr>
	</table>
</div>

			</td>
		</tr>
	</table>
</div>

</div>
<div id="leftmenu">	

	    <div id="blog-calendar" style="display:none"></div><script type="text/javascript">loadBlogDefaultCalendar();</script>
		
<h3>公告</h3>
<div class="News">
	<div id="blog-news"></div><script type="text/javascript">loadBlogNews();</script>
</div>

		<div id="blog-sidecolumn"></div><script type="text/javascript">loadBlogSideColumn();</script>
	
</div>
<div id="main">
	

<div class="post">
	<div class="postTitle">
		<a id="cb_post_title_url" href="http://www.cnblogs.com/chengmo/archive/2010/10/21/1856577.html">linux shell 管道命令(pipe)使用及与shell重定向区别</a>
	</div>
	
	<div class="postText">
		<div id="cnblogs_post_body"><p>看了前面一节：<a href="http://www.cnblogs.com/chengmo/archive/2010/10/20/1855805.html">linux shell数据重定向（输入重定向与输出重定向）详细分析</a> 估计还有一些朋友是头晕晕的，好复杂的重定向了。这次我们看下管道命令了。shell管道，可以说用法就简单多了。 </p> <p>&nbsp;</p> <p><strong>管道命令</strong>操作符是：”|”,它仅能处理经由前面一个指令传出的正确输出信息，也就是 standard output 的信息，对于 stdandard <br>error 信息没有直接处理能力。然后，传递给下一个命令，作为标准的输入 standard input. </p> <p>&nbsp; </p> <ul> <li><strong>管道命令使用说明：</strong> </li></ul> <blockquote> <p>先看下下面图： </p> <p><a href="http://images.cnblogs.com/cnblogs_com/chengmo/WindowsLiveWriter/linuxshellpipe_ACF7/image_2.png"><img title="image" style="border-right: 0px; border-top: 0px; display: inline; border-left: 0px; border-bottom: 0px" height="127" alt="image" src="http://images.cnblogs.com/cnblogs_com/chengmo/WindowsLiveWriter/linuxshellpipe_ACF7/image_thumb.png" width="516" border="0"></a> </p> <p>command1正确输出，作为command2的输入 然后comand2的输出作为，comand3的输入 ，comand3输出就会直接显示在屏幕上面了。 </p> <p>通过管道之后：comand1,comand2的正确输出不显示在屏幕上面 </p> <p><strong>注意：</strong> </p> <p>1、管道命令只处理前一个命令正确输出，不处理错误输出 </p> <p>2、管道命令右边命令，必须能够接收标准输入流命令才行。 </p> <p><strong>实例：</strong> </p> <p>&nbsp;</p><pre class="brush: bash; auto-links: true; collapse: false; first-line: 1; gutter: true; html-script: false; light: false; ruler: true; smart-tabs: true; tab-size: 4; toolbar: true;">[chengmo@centos5 shell]$ cat test.sh | grep -n 'echo'
5:    echo "very good!";
7:    echo "good!";
9:    echo "pass!";
11:    echo "no pass!";
#读出test.sh文件内容，通过管道转发给grep 作为输入内容

[chengmo@centos5 shell]$ cat test.sh test1.sh | grep -n 'echo'
cat: test1.sh: 没有那个文件或目录
5:    echo "very good!";
7:    echo "good!";
9:    echo "pass!";
11:    echo "no pass!";
#cat test1.sh不存在，错误输出打印到屏幕，正确输出通过管道发送给grep 


[chengmo@centos5 shell]$ cat test.sh test1.sh 2&gt;/dev/null | grep -n 'echo'  
5:    echo "very good!";
7:    echo "good!";
9:    echo "pass!";
11:    echo "no pass!";
#将test1.sh 没有找到错误输出重定向输出给/dev/null 文件，正确输出通过管道发送给grep


[chengmo@centos5 shell]$ cat test.sh | ls
catfile      httprequest.txt  secure  test            testfdread.sh  testpipe.sh    testsh.sh      testwhile2.sh
envcron.txt  python           sh      testcase.sh     testfor2.sh    testselect.sh  test.txt       text.txt
env.txt      release          sms     testcronenv.sh  testfor.sh     test.sh        testwhile1.sh
#读取test.sh内容，通过管道发送给ls命令，由于ls 不支持标准输入，因此数据被丢弃</pre>
<p>&nbsp;</p>
<p>这里实例就是对上面2点注意的验证。作用接收标准输入的命令才可以用作管道右边。否则传递过程中数据会抛弃。 常用来作为接收数据管道命令有：sed,awk,cut,head,top,less,more,wc,join,sort,split 等等，都是些文本处理命令。</p></blockquote>
<ul>
<li><strong>管道命令与重定向区别</strong> </li></ul>
<blockquote>
<p><strong>区别是：</strong></p>
<p>1、左边的命令应该有标准输出 | 右边的命令应该接受标准输入<br>&nbsp;&nbsp; 左边的命令应该有标准输出 &gt; 右边只能是文件<br>&nbsp;&nbsp; 左边的命令应该需要标准输入 &lt; 右边只能是文件 </p>
<p>&nbsp;</p>
<p>2、<strong>管道</strong>触发两个子进程执行"|"两边的程序；而<strong>重</strong><strong>定向</strong>是在一个进程内执行</p>
<p>这些都是网上总结很多的，其实只要多加清楚用法，也一定有自己的一份不同描述。</p>
<p><strong>实例：</strong></p><pre class="brush: bash; auto-links: true; collapse: false; first-line: 1; gutter: true; html-script: false; light: false; ruler: true; smart-tabs: true; tab-size: 4; toolbar: true;">#可以相互转换情况
#输入重定向

[chengmo@centos5 shell]$ cat test.sh| grep -n 'echo'
5:    echo "very good!";
7:    echo "good!";
9:    echo "pass!";
11:    echo "no pass!";
#"|"管道两边都必须是shell命令


[chengmo@centos5 shell]$ grep -n 'echo' &lt;test.sh    
5:    echo "very good!";
7:    echo "good!";
9:    echo "pass!";
11:    echo "no pass!";
#"重定向"符号，右边只能是文件（普通文件，文件描述符，文件设备）


[chengmo@centos5 shell]$ mail -s 'test' 8292669@qq.com &lt;test.sh
[chengmo@centos5 shell]$ cat test.sh|mail -s 'test' 8292669@qq.com
#以上2个也相同，将test.sh内容发送到指定邮箱。


[chengmo@centos5 shell]$ (sed -n '1,$p'|grep -n 'echo')&lt;test.sh 
5:    echo "very good!";
7:    echo "good!";
9:    echo "pass!";
11:    echo "no pass!";
#这个脚本比较有意思了。由于前面是管道，后面需要把test.sh内容重定向到 sed ，然后sed输出通过管道，输入给grep.需要将前面用"()"运算符括起来。在单括号内的命令，可以把它们看作一个象一个命令样。如果不加括号test.sh就是grep 的输入了。


#上面一个等同于这个
[chengmo@centos5 shell]$ sed -n '1,$p'&lt;test.sh | grep -n 'echo'
5:    echo "very good!";
7:    echo "good!";
9:    echo "pass!";
11:    echo "no pass!";

#重定向运算符，在shell命令解析前，首先检查的（一个命令，执行前一定检查好它的输入，输出，也就是0,1,2 设备是否准备好），所以优先级会最高


[chengmo@centos5 shell]$ sed -n '1,10p'&lt;test.sh | grep -n 'echo' &lt;testsh.sh
10:echo $total;
18:echo $total;
21:     echo "ok";
#哈哈，这个grep又接受管道输入，又有testsh.sh输入，那是不是2个都接收呢。刚才说了"&lt;"运算符会优先，管道还没有发送数据前，grep绑定了testsh.sh输入，这样sed命令输出就被抛弃了。这里一定要小心使用

#输出重定向

[chengmo@centos5 shell]$ cat test.sh&gt;test.txt
[chengmo@centos5 shell] cat test.sh|tee test.txt &amp;&gt;/dev/null
#通过管道实现将结果存入文件,还需要借助命令tee，它会把管道过来标准输入写入文件test.txt ,然后将标准输入复制到标准输出(stdout),所以重定向到/dev/null 不显示输出
#"&gt;"输出重定向，往往在命令最右边，接收左边命令的，输出结果，重定向到指定文件。也可以用到命令中间。


[chengmo@centos5 shell]$ ls test.sh test1.sh testsh.sh 2&gt;err.txt | grep 'test'
test.sh
testsh.sh
#目录下面有：test,testsh文件，test1.sh不存在，因此将ls 命令错误输出输入到err.txt 正确输出，还会通过管道发送到grep命令。
[chengmo@centos5 shell]$ ls test.sh test1.sh testsh.sh &amp;&gt;err.txt | grep 'test' 
#这次打印结果是空，&amp;代表正确与错误输出 都输入给err.txt，通过管道继续往下面传递数据为空,所以没有什么显示的

#同样"&gt;"输出重定向符，优先级也是先解析，当一个命令有这个字符，它就会与左边命令标准输出绑定。准备好了这些，就等待命令执行输出数据，它就开始接收</pre>
<p>&nbsp;</p>
<p><strong> 再概括下：</strong></p>
<p>从上面例子可以看，重定向与管道在使用时候很多时候可以通用，其实，在shell里面，经常是【条条大路通罗马】的。<font color="#0000ff">一般如果是命令间传递参数，还是管道的好，如果处理输出结果需要重定向到文件，还是用重定向输出比较好。</font></p>
<p><font color="#0000ff"><font color="#000000">命令执行顺序可以看下：</font><a href="http://www.cnblogs.com/chengmo/archive/2010/10/17/1853344.html">Linux Shell 通配符、元字符、转义符使用实例介绍</a></font></p>
<p>&nbsp;</p></blockquote>
<p>&nbsp;</p>
<ul>
<li><strong>shell脚本接收管道输入</strong> </li></ul>
<blockquote>
<p><strong>有意思的问题：</strong></p>
<p>既然作用管道接收命令，需要可以接收标准的输入，那么我们shell脚本是否可以开发出这样的基本程序呢？（大家经常看到的，都是一些系统的命令作为管道接收方）</p>
<p><strong>实例（testpipe.sh)：</strong></p><pre class="brush: bash; auto-links: true; collapse: false; first-line: 1; gutter: true; html-script: false; light: false; ruler: true; smart-tabs: true; tab-size: 4; toolbar: true;"> #!/bin/sh
 
 if [ $# -gt 0 ];then
     exec 0&lt;$1;
#判断是否传入参数：文件名，如果传入，将该文件绑定到标准输入
 fi
 
 while read line
 do
     echo $line;
 done&lt;&amp;0;
#通过标准输入循环读取内容
 exec 0&amp;-;
#解除标准输入绑定</pre>
<p><strong>运行结果：</strong></p><pre class="brush: bash; auto-links: true; collapse: false; first-line: 1; gutter: true; html-script: false; light: false; ruler: true; smart-tabs: true; tab-size: 4; toolbar: true;">[chengmo@centos5 shell]$ cat testpipe.txt
1,t,est pipe
2,t,est pipe
3,t,est pipe
4,t,est pipe
#testpipe.txt 只是需要读取的测试文本

[chengmo@centos5 shell]$ cat testpipe.txt | sh testpipe.sh
1,t,est pipe
2,t,est pipe
3,t,est pipe
4,t,est pipe
#通过cat 读取 testpipe.txt 发送给testpipe.sh 标准输入

[chengmo@centos5 shell]$ sh testpipe.sh testpipe.txt      
1,t,est pipe
2,t,est pipe
3,t,est pipe
4,t,est pipe
#testpipe.sh 通过出入文件名读取文件内容</pre></blockquote></div><div id="MySignature"></div>
<div class="clear"></div>
<div id="blog_post_info_block">
<div id="BlogPostCategory"></div>
<div id="EntryTag"></div>
<div id="blog_post_info">
</div>
<div class="clear"></div>
<div id="post_next_prev"></div>
</div>


	</div>
	
	<div class="postfoot">
		posted on <span id="post-date">2010-10-21 09:53</span> <a href='http://www.cnblogs.com/chengmo/'>程默</a> 阅读(<span id="post_view_count">...</span>) 评论(<span id="post_comment_count">...</span>)  <a href ="http://i.cnblogs.com/EditPosts.aspx?postid=1856577" rel="nofollow">编辑</a> <a href="#" onclick="AddToWz(1856577);return false;">收藏</a>
	</div>
</div>
<script type="text/javascript">var allowComments=true,isLogined=false,cb_blogId=71819,cb_entryId=1856577,cb_blogApp=currentBlogApp,cb_blogUserGuid='eee985f0-5b74-df11-ba8f-001cf0cd104b',cb_entryCreatedDate='2010/10/21 9:53:00';loadViewCount(cb_entryId);</script>

<a name="!comments"></a><div id="blog-comments-placeholder"></div><script type="text/javascript">var commentManager = new blogCommentManager();commentManager.renderComments(0);</script>
<div id="comment_form" class="commentform">
<a name="commentform"></a>
<div id="divCommentShow"></div>
<div id="comment_nav"><span id="span_refresh_tips"></span><a href="javascript:void(0);" id="lnk_RefreshComments" onclick="return RefreshCommentList();">刷新评论</a><a href="#" onclick="return RefreshPage();">刷新页面</a><a href="#top">返回顶部</a></div>
<div id="comment_form_container"></div>
<div class="ad_text_commentbox" id="ad_text_under_commentbox"></div>
<div id="site_nav_under"><a href="http://www.cnblogs.com/" target="_blank" title="开发者的网上家园">博客园首页</a><a href="http://q.cnblogs.com/" target="_blank" title="程序员问答社区">博问</a><a href="http://news.cnblogs.com/" target="_blank" title="IT新闻">新闻</a><a href="http://home.cnblogs.com/ing/" target="_blank">闪存</a><a href="http://job.cnblogs.com/" target="_blank">程序员招聘</a><a href="http://kb.cnblogs.com/" target="_blank">知识库</a></div>
<div id="opt_under_post"></div>
<script type="text/javascript">
    var enableGoogleAd = canShowAdsense(); 
    fixPostBodyFormat();
</script>
<script type='text/javascript'>
  var googletag = googletag || {};
  googletag.cmd = googletag.cmd || [];
    (function () {
        if (enableGoogleAd) {
            var gads = document.createElement('script');
            gads.async = true;
            gads.type = 'text/javascript';
            var useSSL = 'https:' == document.location.protocol;
            gads.src = (useSSL ? 'https:' : 'http:') +
              '//www.googletagservices.com/tag/js/gpt.js';
            var node = document.getElementsByTagName('script')[0];
            node.parentNode.insertBefore(gads, node);
        }
  })();
</script>
<script type='text/javascript'>
    try {
        if (enableGoogleAd) {
            googletag.cmd.push(function() {
            googletag.defineSlot('/1090369/cnblogs_blogpost_C2', [468, 60], 'div-gpt-ad-1433581717989-0').addService(googletag.pubads());
            googletag.defineSlot('/1090369/cnblogs_blogpost_C1_sitehome', [300, 250], 'div-gpt-ad-1433581717989-1').addService(googletag.pubads());
            googletag.pubads().enableSingleRequest();
            googletag.pubads().collapseEmptyDivs();
            googletag.enableServices();
            });
        };
    } catch (e) { }
</script>
<div id="google_ad_c1" class="c_ad_block">
    <div id='div-gpt-ad-1433581717989-1' style='height:250px; width:300px;'>
    <script type='text/javascript'>
        try {
            if (enableGoogleAd) {
                googletag.cmd.push(function () { googletag.display('div-gpt-ad-1433581717989-1'); });
            } else {
                $('#div-gpt-ad-1433581717989-1').hide();
            }
    } catch (e) { }
    </script>
    </div>
</div>
<div id="under_post_news"></div>
<div id="google_ad_c2" class="c_ad_block">
<div id='div-gpt-ad-1433581717989-0' style='height:60px; width:468px;'>
<script type='text/javascript'>
try {
    if (enableGoogleAd) {
        googletag.cmd.push(function () { googletag.display('div-gpt-ad-1433581717989-0'); });
    } else {
        $('#div-gpt-ad-1433581717989-0').hide();
    }
} catch (e) { }
</script>
</div>
</div>
<div id="under_post_kb"></div>
<div id="HistoryToday" class="c_ad_block"></div>
<script type="text/javascript">
$(function () {
    loadNewsAndKb();
    loadBlogSignature();
    LoadPostInfoBlock(cb_blogId, cb_entryId, cb_blogApp, cb_blogUserGuid);
    GetPrevNextPost(cb_entryId, cb_blogId, cb_entryCreatedDate);
    loadOptUnderPost();
    GetHistoryToday(cb_blogId, cb_blogApp, cb_entryCreatedDate);
    setTimeout(function () { incrementViewCount(cb_entryId); }, 200);
});
</script>
</div>

</div>
<div class="footer">

<p id="footer">
	Powered by: 
	<br />
	
	<a id="Footer1_Hyperlink3" NAME="Hyperlink1" href="http://www.cnblogs.com/" style="font-family:Verdana;font-size:12px;">博客园</a>
	<br />
	Copyright &copy; 程默
</p>
</div>
<!--PageEndHtml Block Begin-->
<!-- Baidu Button BEGIN -->



<noscript><a href="http://www.linezing.com"><img src="http://img.tongji.linezing.com/3462101/tongji.gif"/></a></noscript>
<!-- Baidu Button END -->
<!--PageEndHtml Block End-->
</body>
</html>
